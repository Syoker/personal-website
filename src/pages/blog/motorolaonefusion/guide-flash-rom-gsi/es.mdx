import { Head } from 'src/components/shared';
import { Video } from 'src/components/Article';

<Head
	title="[Guía] Flash ROM GSI"
	description="Guía para flashear una ROM GSI en el dispositivo Motorola One Fusion | Astro"
	ogUrl="https://syoker.github.io/es/blog/motorolaonefusion/guide-flash-rom-gsi"
	ogTitle="[Guía] Flash ROM GSI"
	ogDescription="Guía para flashear una ROM GSI en el dispositivo Motorola One Fusion | Astro"
	ogImage="https://raw.githubusercontent.com/Syoker/syoker.github.io/main/public/img/banner-flashromgsi.png"
/>

En esta guía, les mostraré como flashear una ROM GSI en nuestro dispositivo. Este proceso va a formatear su dispositivo, por lo que recomiendo realizar una copia de seguridad antes.

Todo esto es bajo su responsabilidad, no me hago responsable de ningún daño causado a su dispositivo.

## **¿Qué necesito?**

- ### **SDK Platform Tools**
    
    Las *SDK Platform tools de Android* son un componente del SDK de Android. Incluyen herramientas que interactúan con la plataforma de Android, como <code><a href="https://developer.android.com/studio/command-line/adb">adb</a></code>, <code><a href="https://android.googlesource.com/platform/system/core/+/master/fastboot/#fastboot">fastboot</a></code> y <code><a href="https://developer.android.com/topic/performance/tracing/command-line">systrace</a></code>. Estas herramientas son necesarias para el desarrollo de apps para Android, o bien si quieres desbloquear el bootloader de tu dispositivo y actualizarlo con una nueva imagen del sistema.

  	Link de descarga - [SDK Platform Tools](https://developer.android.com/studio/releases/platform-tools)
    
- ### **Motorola Drivers**
    
    Esto contiene los drivers USB para que la PC pueda reconocer su dispositivo y trabajar con él cuándo esté en Bootloader o en Fastbootd.
    
    Link de descarga - [Motorola](https://motorola-global-es-latam.custhelp.com/app/answers/detail/a_id/89882)
    
- ### **Firmware Oficial**
    
    Usted va a requerir descargar firmware oficial correspondiente a su canal de software para su dispositivo, **NUNCA DESCARGUE UN FIRMWARE DE OTRO CANAL.** Para saber cuál es el firmware correspondiente a su dispositivo, tiene que fijarse en el canal al cual pertenece en la app de configuraciones, dentro del apartado "Acerca del teléfono" en "Canal de Software".
    
    Link de descarga - [Mirrors Lolinet](https://mirrors.lolinet.com/firmware/moto/astro/official/)
    
- ### **Windows Terminal (opcional)**
    
    Si usted tiene windows 8, 8.1 o 10, bájese de la tienda de Windows esta terminal, ya que va a obtener una función que va a necesitar en esta guía. Una vez obtenida la tienda, configure la misma para que el perfil predeterminado sea el símbolo del sistema (CMD).
    
    Link de descarga - [Microsoft Store](https://www.microsoft.com/store/productId/9N0DX20HK701)
    
- ### **Depuración USB**
    
    En esta guía usaremos la depuración USB para acceder al modo fastbootd.
    
    Para habilitar la depuración USB, usted tiene que ir a la app de configuraciones, en el apartado de "Acerca del teléfono" en "Número de compilación" y tocar 7 veces. Luego, tiene que acceder a las "Opciones para desarrolladores" en la app de configuraciones en el apartado "Sistema" y activar la "Depuración USB". Tiene que salir un cartel en el celular de la PC pidiendo permisos para poder acceder al celular, si no aparece, desactive y vuelva a activar la opción o desconecte y vuelva a conectar el celular.
    
- ### **Bootloader desbloqueado**
    
    Es necesario haber desbloqueado el bootloader para poder instalar un Custom Recovery en nuestro dispositivo. Si aún no lo han desbloqueado, les dejaré el link a la guía que hice explicando paso a paso lo que tienen que hacer.
    
    Link de la guía - [[Guía] Unlock bootloader](https://syoker.github.io/es/blog/motorolaonefusion/guide-unlock-bootloader/)
    
- ### **Custom Recovery y ROOT (opcional)**
    
    Es recomendable tener un Custom Recovery y tener ROOT en el dispositivo antes de instalar una GSI, puesto que las GSI tienen varios problemas visuales en nuestro dispositivo, que se arreglan con modulos para Magisk. Por ende, si usted aún no instalo un Custom Recovery, le dejaré un link de una guía que hice para instalar un Custom Recovery y también un .zip de un Magisk flasheable por un Custom Recovery.
    
    Link de la guía - [[Guía] Flash Custom Recovery](https://syoker.github.io/es/blog/motorolaonefusion/guide-flash-custom-recovery/)
    
    Link de Magisk - [Magisk v25.2](/files/Magisk-v25.2.zip)
    
- ### **Generic System Image (GSI)**
    
    Las GSI tienen diferentes variantes para cada tipo de arquitectura, sistema de partición, si tienen gapps o son vanilla, etc. A continuación les mostraré cómo distinguir cada tipo de versión.

	```
	Arquitecturas:
	- arm: Arquitectura ARM de 32bits.
	- a64: Arquitectura ARM de 32bits con binder de 64bits.
	- arm64: Arquitectura ARM de 64bits.
	Sistema de partición:
	- A: Dispositivos con una partición (a-only).
	- B: Dispositivos con dos particiones (A/B).
	Versión del sistema:
	- g: Contiene Gapps (gapps).
	- o: Contiene la versión GO de las gapps (go-gapps).
	- v: No contiene gapps (vanilla).
	- f: Contiene un sistema de gapps open-source (floss).
	Superuser:
	- N: No trae superuser.
	- S: Trae PHH superuser (genera conflicto con Magisk).
	- Z: Trae Dynamic Superuser de Eremitein (genera conflicto con Magisk).
	Tipo de build:
	- vndklite o lite: Para dispositivos con vendor vndklite o para un sistema de lecto-escritura en dispositivos normales.
	- personal: Contiene mods personales del desarrollador.
	- secure: Con superuser removido.
	Tamaño de gapps (si es que tiene):
	- Normal: Cantidad normal de gapps.
	- Slim: Con una cantidad reducida de gapps.
	```

    Para tener en cuenta, nuestro dispositivo tiene una arquitectura ARM64 y un sistema de particiones A/B. También aclarar que soporta un tamaño máximo de 3.66GB en la imagen.
    
    La versión que personalmente recomiendo sería `arm64_BgN Normal`.
    
    Aunque de todas formas, les dejaré un enlace a un canal donde pasamos ROMs GSI que funcionan en nuestro dispositivo perfectamente, lo anterior es por si quiere probar por su cuenta ROMs GSI que no estén en el canal.
    
    Link del canal - [Motorola One Fusion | Updates](https://t.me/OneFusionUpdates/3)
    

## **Procedimiento para flashear la ROM GSI**

1. Descomprima la carpeta platform-tools que obtuvo desde la página **Android Developers**, luego descomprima el archivo del firmware oficial obtenido de **Mirrors Lolinet** y también descomprima el archivo de la GSI y mueva todos los archivos de esta carpeta a la carpeta platform-tools.
    
![Ejemplo de carpeta](/img/guide-examplefolder.png)

2. Si usted tiene la **Windows Terminal** obtenida desde la **Microsoft Store**, simplemente abra el CMD dentro de la carpeta haciendo clic secundario en una parte vacía de la carpeta y seleccionando la opción "Abrir en Terminal".
    
<Video src="/video/opencommandprompt.mp4" />

Si usted no tiene la **Windows Terminal**, dentro de la carpeta en un espacio vacío haga shift+clic secundario y seleccione la opción "Abrir la ventana de PowerShell aquí", escriba `cmd` dentro de la ventana y presione enter.

<Video src="/video/openwindowspowershell.mp4" />

3. Conecte el dispositivo a la PC, escriba en el CMD `adb devices` (el teléfono tiene que estar encendido para que este comando funcione, en el caso de que ya esté en bootloader, escriba `fastboot devices`) y presione enter. Si la consola no le devuelve

  	```bash
  	List of devices   attached
  	ZE222BZWFF        device
  	```

  	entonces asegúrese de que tenga conectado bien el dispositivo, o haya activado la depuración USB.
    
4. Ahora reinicie al fastbootd con `adb reboot fastboot`.
    
    Sabrá que está en el fastbootd ya que se iniciará una pantalla especial del recovery indicando que está en el modo fastboot. O en su defecto en el recovery stock aparecerá un cartel en grande donde dice "Fastbootd".
    
5. Una vez en el fastbootd, setearemos la partición activa del dispositivo en el A con:

	```bash
	fastboot --set-active=a
	```
    
6. Entonces procederemos a inhabilitar el inicio verificado ([AVB](https://source.android.com/security/verifiedboot/avb)) con el comando:
    
	```bash
	fastboot --disable-verification flash vbmeta vbmeta.img
	```
		
7. Una vez inhabilitado el inicio verificado, borraremos el sistema actual para instalar después el que queramos con el siguiente comando:
    
	```bash
	fastboot erase system
	```
		
8. Ahora flashearemos un [product especial](/files/product_gsi.img) (pegue el archivo descargado dentro de la carpeta platform-tools y no modifique el nombre) que nos dará más espacio para la GSI con el siguiente comando:
    
	```bash
	fastboot flash product product_gsi.img
	```
    
9. Ahora toca flashear la ROM GSI, utilizaremos el siguiente comando:
    
	```bash
	fastboot flash system "system.img"
	```

  	Donde "system.img" es el nombre de la ROM GSI, va sin las comillas y con el ".img".
    
10. Luego de instalada la ROM GSI, expandiremos el tamaño de la partición para tener un mayor espacio para los modulos que instalaremos, este paso es opcional, pero recomendable (tener en cuenta que este comando causará bootloop si no has rooteado el teléfono previamente). Usaremos el siguiente comando:
    
	```bash
	fastboot resize-logical-partition system_a 3800000000
	```
    
11. Ahora vamos a reiniciar al bootloader con `fastboot reboot bootloader` para formatear el dispositivo (si se saltea este paso, puede obtener un bootloop) con el siguiente comando:

		```bash
		fastboot -w
		```
	Si no funciona el comando, puede usar este otro:
	
		```bash
  	fastboot erase userdata
		```
    
12. Una vez formateado el sistema, iniciaremos en él con `fastboot reboot` y listo.
    
## **Soluciones y tips**

- ### **Copia de seguridad del IMEI**
    
  Siempre hagan una copia de seguridad de su IMEI por las dudas de un posible caso de perdida de IMEI. Lo único qu tiene que hacer es, desde OrangeFox o TWRP entrar al apartado de copia de seguridad, seleccionar un almacenamiento externo (tarjeta SD) y añadir una nueva copia de seguridad, seleccionando las carpetas EFS, Modem y Persist.
    
![guide_imei-backup](/img/guide-imeibackup.png)

- ### **Vida del eMMC**
    
  Para ver la vida de su eMMC (el almacenamiento interno) solamente tiene que ejecutar el comando que les voy a dejar desde [Termux](https://f-droid.org/repo/com.termux_118.apk). Si o si necesitan ROOT en su dispositivo.

		```bash
		su -c cat /sys/class/mmc_host/mmc0/mmc0:0001/life_time
		```

  Su eMMC está en peligro si la respuesta a este comando es 0x08 0x03 o más, mientras más cercano sea su número al anterior mencionado, más desgastado estará su eMMC. El número de un eMMC nuevo es 0x01 0x01.
    

![guide_emmc-life](/img/guide-emmclife.png)

- ### **Solución al problema de los SMS**
    
    Para solucionar el problema de que los SMS no llegan, simplemente tiene que ir a "Configuraciones/Phh Treble Settings/IMS features" y seleccionar la opción "Install IMS APK for Qualcomm vendor", después esperar a que se instale el apk (saldrá un cartel avisando) y reiniciar el dispositivo.
    

![guide_solution-to-sms-problem](/img/guide-solutionsmsproblem.png)

- ### **Certificación de dispositivo**
    
    Si tienen el problema de la certificación de la Play Store (se darán cuenta cuando les salte una notificación diciendo "Este dispositivo no está certificado") lo que tienen que hacer es instalar la app [Device ID](https://play.google.com/store/apps/details?id=com.evozi.deviceid), dentro de la app copiar el GSF ID (Google Service Framework ID), con ese ID, registrarlo en Google [acá](https://www.google.com/android/uncertified) (pegue su ID en el único lugar de entrada de texto que hay en la página y toque el botón "Registrarse"), luego reinicia el teléfono y limpia los datos de la Google Play Store en "Información de la app/Almacenamiento y caché/Liberar espacio de almacenamiento" y listo (tarda un poco en aplicarse).
    

![guide_device-certification](/img/guide-devicecertification.png)

Si tienen alguna duda, pasen por el grupo de Telegram de nuestro dispositivo [Motorola One Fusion | Español™](https://t.me/MotorolaOneFusionES).
